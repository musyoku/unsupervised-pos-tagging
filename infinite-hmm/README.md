## The Infinite Hidden Markov Model

- [The Infinite Hidden Markov Model](http://mlg.eng.cam.ac.uk/zoubin/papers/ihmm.pdf)
- [Beam Sampling for the Infinite Hidden Markov Model](http://mlg.eng.cam.ac.uk/pub/pdf/VanSaaTehGha08.pdf)
- [実装について](http://musyoku.github.io/2017/02/27/Infinite-Hidden-Markov-Model%E3%81%AB%E3%82%88%E3%82%8B%E6%95%99%E5%B8%AB%E3%81%AA%E3%81%97%E5%93%81%E8%A9%9E%E6%8E%A8%E5%AE%9A/)

#### Todo:

- [ ] ハイパーパラメータのサンプリング
- [ ] ビームサンプリング

## 準備

### macOS

macOSの場合、PythonとBoostはともにbrewでインストールする必要があります。

#### Python 3のインストール

```
brew install python3
```

`PYTHONPATH`を変更する必要があるかもしれません。

#### Boostのインストール

```
brew install boost-python --with-python3
```

### Linux

#### Boostのインストール

```
./bootstrap.sh --with-libraries=python --with-python=python3 --with-python-root=YOUR_PYTHON_ROOT
./b2 python=3.6 -d2 -j4
```

### ビルド

以下のコマンドで`bhmm.so`が生成され、Pythonから利用できるようになります。

```
make install
```

`makefile`のBoostのincludeパスを自分の環境に合わせて書き換えてください。

### MeCabのインストール

```
pip install mecab-python3
```

## 学習

英語のテキストファイルの場合は以下のコマンドで学習できます。

```
python3 train_en.py  -f ../../text/ptb.txt -split 1 -tags 1 -e 40000
```

日本語のテキストファイルの場合は以下のコマンドで学習できます。

```
python3 train_ja.py  -f ../../text/neko.txt -split 1 -tags 1 -e 40000
```

## 結果の可視化

各予測タグとそれに割り当てられた単語を表示するには以下のコマンドを実行します。

```
python3 tags.py -n 200
```

混同行列をプロットするには以下のコマンドを実行します。

```
python3 plot_ja.py -f ../../text/kokoro.txt
```

学習時に使用したテキストファイルを指定します。

## 結果

### こゝろ

`kokoro.txt`の学習結果です。

```
python3 train_ja.py  -f ../../text/neko.txt -split 1 -tags 1 -e 40000 -cwd neko
```

![result](https://raw.githubusercontent.com/musyoku/images/master/pos_tagging/ihmm/kokoro.png)

```
[1]
と(57) 
[2]
の(4221) な(537) に(81) という(63) と(44) が(39) に対する(38) や(31) とも(30) ##(27) らしい(16) か(10) 々(10) とか(5) とかいう(5) しい(5) やら(4) 込む(3) っぽい(2) 臭い(2) つん(2) 始め(1) 
[3]
。(4654) 」(459) 
[4]
事(557) よう(473) もの(273) 方(200) 前(155) 気(145) 中(144) 顔(135) 言葉(127) ため(127) うち(118) 上(108) だけ(97) 間(87) 心(86) 室(76) 眼(74) 所(69) 意味(69) ところ(67) 病気(63) 後(63) 様子(61) 声(60) 問題(55) 話(54) 態度(54) 心持(53) 返事(53) 手紙(51) 人間(45) 口(45) 訳(45) 頭(43) 点(43) など(43) 風(42) 傍(41) 胸(40) 家(39) 調子(39) 場合(38) ばかり(36) 身体(34) 過去(34) 気分(33) 下(28) 先(28) 機会(28) 力(27) まで(26) 
[5]
まし(1033) い(571) し(532) なかっ(414) ませ(369) れ(279) 来(106) られ(83) なけれ(81) せ(68) 出し(68) くれ(43) しまっ(38) でし(37) み(36) 行っ(33) なっ(29) ましょ(29) 始め(26) たかっ(20) なかろ(18) なくっ(18) っ(17) おい(17) 付け(15) おき(14) き(13) もらっ(13) つけ(12) え(11) なく(10) 留まっ(10) 切っ(10) させ(8) 直し(8) しよ(8) みよ(7) たろ(7) 返し(7) なり(6) だろ(6) 上っ(6) かけ(6) り(5) 浮べ(5) 込ん(4) 移っ(4) せよ(4) 廻り(4) しかっ(4) わし(4) 
[6]
私(2693) 先生(568) Ｋ(353) 奥さん(327) 彼(273) 父(269) それ(176) あなた(156) 母(156) お嬢さん(124) これ(85) 自分(78) 妻(77) 兄(62) 叔父(41) 他(41) 医者(35) 誰(34) 例(32) いつも(32) 君(32) 今(31) お前(30) 心(30) おれ(30) 彼ら(30) 我々(28) お父さん(27) 人間(26) 少し(25) 子供(23) 普通(23) 平生(22) 世間(22) 今度(20) 元(20) こっち(18) 始め(18) 下女(18) 恋(16) 次(16) そこ(15) 最初(15) お母さん(15) 妹(15) 相当(15) 友達(14) 無理(14) 固(13) 笑い(12) 坊さん(12) 
[7]
た(5392) です(1052) う(541) ん(374) ます(245) ない(100) だ(80) ね(47) られる(37) たい(25) てる(18) よ(14) さ(13) ちゃ(11) まい(10) なさい(7) な(5) 得る(5) ）(5) 始める(4) すか(4) 尋ねる(3) みえる(3) にくい(2) いおう(2) 通し(1) 
[8]
、(3643) も(150) いる(75) さえ(13) たった(8) ますます(7) 横たわる(6) 絶えず(6) 高等(6) ぼんやり(5) 心持(4) 否や(4) 疑い深い(3) かつ(3) 大して(3) 遠慮なく(3) 待ち受ける(3) 毎年(2) 紅茶(2) 住む(2) 生憎(2) 慰める(2) 度々(2) 護謨(2) ひとり(2) 編(2) ほどなく(2) 拙い(2) 宜しく(2) 馬鹿馬鹿しい(2) こりゃ(2) 尊(2) もし(1) 推測(1) こそ(1) 
[9]
あり(231) い(207) も(131) は(111) いい(110) なら(99) し(80) 知れ(78) なり(75) でき(71) 思い(59) いわ(58) さ(54) 来(53) 思わ(52) 知ら(51) 聞き(44) 答え(42) どう(41) 死ん(38) 聞か(35) 卒業(30) 見え(30) 解ら(29) 違い(27) しまい(26) くれ(26) 帰り(26) 行き(26) 分ら(25) いけ(24) なれ(22) 心配(22) やり(22) 歩き(21) 行か(21) 判然(21) 想像(20) 構わ(19) じゃ(17) 考え(17) 笑い(17) 気の毒(17) 大丈夫(16) いえ(16) 見せ(16) 立ち(15) 悪く(15) 解釈(15) 分り(15) 知り(14) 
[10]
の(1577) と(1307) か(472) から(371) でし(306) が(278) ん(205) でしょ(148) 時(137) だろ(134) ので(95) よ(88) もの(80) かも(59) ね(57) けれども(56) だっ(46) 通り(40) し(38) くらい(36) のに(34) なら(33) よう(30) じゃ(26) って(26) つもり(24) らしかっ(24) ごとく(24) ほど(23) …(22) や(21) わ(21) です(19) だけ(19) まま(19) はず(19) 事(18) 結果(18) とか(17) そう(16) 以上(15) 後(15) なり(13) 男(12) として(12) かい(12) とも(11) がっ(9) 限り(8) せい(6) かしら(6) 
[11]
ない(891) だ(514) いる(411) する(318) ある(228) いう(142) なる(126) な(117) れる(84) 来る(71) 好い(66) 思う(61) です(60) 行く(60) 見る(59) 同じ(53) 悪い(36) 死ぬ(34) 下さい(33) 出る(33) せる(31) 何(30) 帰る(30) いい(30) どこ(27) 」(26) 聞く(25) みる(25) できる(25) くれる(25) たい(23) …(22) 出す(22) 立つ(21) くれ(19) 見える(17) やる(17) 起る(16) 淋しい(15) 答える(13) 強い(13) ？(13) どう(12) 過ぎる(12) る(12) 考える(12) 困る(11) 買う(11) 話す(11) しまう(11) 済まない(11) 
[12]
人(388) 時(236) 日(117) そう(110) 女(77) 家(56) 的(55) 男(53) 通り(51) 頃(47) くらい(44) 年(43) 向う(36) 度(33) あなた(31) さ(28) 時間(28) 先生(27) 代り(27) 金(26) 机(25) 一種(25) さん(24) ##(23) どっち(23) 時分(23) 町(23) 晩(23) 覚悟(22) 海(22) 田舎(22) 一つ(21) 関係(21) 自由(20) 不安(20) 下宿(20) 事件(19) 目的(19) 供(19) 幸福(18) 簡単(18) 生活(18) 愉快(17) 物(17) 昔(16) 夏(16) 目(16) 大学(16) 茶の間(16) 何(15) 分(15) 
[13]
「(707) その(685) ##(561) しかし(214) この(166) そうして(131) けれども(78) すると(62) それから(56) ただ(48) それで(43) あの(40) だから(39) 実際(37) ある(36) もし(35) 上(33) ――(32) 若い(32) それでも(31) そういう(27) こういう(26) ことに(25) あるいは(24) ところが(23) 新しい(23) ご(22) もっとも(22) 小(22) つまり(21) 同時に(20) 強い(19) しかも(18) そんな(16) それでいて(16) どの(15) とにかく(15) どうも(15) 卒業(14) 広い(14) みんな(14) やはり(13) そうした(13) でも(12) おそらく(12) 無論(12) たった(12) 常に(12) やがて(12) 己(11) （(11) 
[14]
て(3368) ば(230) ず(112) ながら(86) たり(73) たら(71) なく(60) さ(36) たく(31) ない(30) られ(30) ちゃ(15) ら(13) つつ(11) 得(9) って(9) だら(7) つ(7) と共に(6) がち(5) やし(5) 談(5) 気遣い(3) 次第(3) がたい(3) とう(3) うた(3) 向い(2) なさい(2) たって(2) べから(2) 合い(2) かる(2) 繰り返し(1) 
[15]
し(585) あっ(349) いっ(270) なっ(219) 見(157) 出(141) 聞い(110) 思っ(109) い(107) 帰っ(95) 考え(90) 来(88) 行っ(69) もっ(55) なかっ(50) 見え(50) 立っ(50) でき(48) 書い(47) 話し(43) 坐っ(42) 出し(40) 知っ(39) 持っ(38) 黙っ(38) 答え(37) 信じ(35) 得(35) 眺め(34) 違っ(34) 向っ(31) 付い(31) 生き(30) 忘れ(27) 取っ(27) 与え(27) 生れ(26) 受け(26) やっ(26) 開け(26) 置い(25) 掛け(24) 寝(23) 入れ(23) すれ(22) 着い(22) 歩い(22) 笑っ(22) 感じ(20) 繰り返し(20) 始め(20) 
[16]
また(265) まだ(109) すぐ(106) よく(92) もう(79) ただ(74) そう(70) こう(69) この(68) お(61) 少し(59) 今(57) 同じ(56) そんな(53) 突然(47) なぜ(47) まるで(47) むしろ(43) ほとんど(42) どう(42) 全く(41) ちょっと(38) こんな(38) かえって(37) 決して(35) 時々(35) とうとう(31) 段々(30) それほど(30) 大きな(28) 落ち(28) いくら(27) どうして(27) これから(27) ついに(26) 大変(26) きっと(26) もっと(26) ああ(24) まあ(23) わざわざ(22) 何とも(22) どうしても(22) 黒い(21) 早く(21) 信用(21) どんな(21) 長い(21) しばらく(21) なお(20) 無論(20) 
[17]
に(4006) を(3214) で(1497) が(1252) へ(518) も(423) から(336) と(326) まで(140) でも(110) として(91) について(64) は(60) じゃ(46) だけ(42) さえ(41) ばかり(39) より(35) なら(30) らしく(22) しか(20) ほど(20) だの(20) ぎり(12) において(12) など(11) たち(11) ッ(10) ずつ(9) と共に(9) ぐらい(9) こそ(8) り(7) って(6) 以後(6) に関して(6) によって(5) つき(5) にかけて(4) 置(3) 化(3) はまる(3) 戯(3) なんぞ(3) めかし(2) ぎ(2) 何もかも(2) だり(2) むずかしく(2) かた(2) 生き(1) 
[18]
それ(227) 自分(186) 何(174) そこ(103) 東京(74) 今(61) 奥さん(61) どこ(60) 宅(59) Ｋ(58) 口(57) 手(55) 急(54) 眼(49) 仕方(45) お嬢さん(44) 変(43) 彼(41) いつ(40) いっしょ(40) 外(38) ここ(37) 学校(37) 世の中(34) 頭(30) 厭(29) 叔父(29) 妻(28) 静か(26) 先(25) 国(23) 手紙(23) 自然(23) 読ん(22) 最後(22) 書物(21) 床(21) 凝(21) すべて(20) 足(20) 今日(20) 座敷(20) 真面目(19) 満足(19) 世話(19) 呼ん(18) 相手(18) 飯(18) 席(18) 玄関(18) 平気(18) 
[19]
は(3973) が(624) も(602) と(246) から(133) より(67) に対して(46) なく(44) や(33) でも(22) にとって(19) だって(17) ほど(12) ながら(10) すら(9) なんか(8) 以来(7) なら(6) 自身(6) のみ(4) 蠅(4) せよ(3) 寛(3) 大変(2) 悪く(2) いまだ(2) 代る代る(2) 憎らしく(2) 生(2) 悲しく(2) 更(2) 私語(2) しも(2) そう(1) ら(1) 
[21]
という(258) か(179) 」(167) より(54) べき(45) な(42) もの(39) といった(38) と(32) らしい(31) から(24) がる(20) だけ(16) まで(15) まい(14) 大きな(6) さ(6) とかいう(6) のに(5) 限り(5) 好奇(5) べく(5) 掛(4) ぎり(4) 辛い(4) ものの(4) なり(3) 時分(3) 尊い(3) 軽い(3) 杉(3) 四月(3) 打ち明け(2) 渇く(2) っていう(2) に関する(2) 痕(2) 幹(2) いち(2) 社交(2) 汚い(2) 厳しい(2) 絵(2) 男らしい(2) 軽(2) 伽藍(2) ほど(1) 時代(1) 
```
